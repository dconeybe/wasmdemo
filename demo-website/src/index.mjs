"use strict";

const WASM_BASE64 = "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NgIEIAFBACgCmImAgABHDQFBACAANgKMiYCAAA8LIAMgAkF+cTYCBCABIABqIAA2AgAgASAAQQFyNgIECwJAIABB/wFLDQAgAEF4cUGsiYCAAGohAgJAAkBBACgChImAgAAiBEEBIABBA3Z0IgBxDQBBACAEIAByNgKEiYCAACACIQAMAQsgAigCCCEACyAAIAE2AgwgAiABNgIIIAEgAjYCDCABIAA2AggPC0EfIQICQCAAQf///wdLDQAgAEEIdiICIAJBgP4/akEQdkEIcSICdCIEIARBgOAfakEQdkEEcSIEdCIGIAZBgIAPakEQdkECcSIGdEEPdiACIARyIAZyayICQQF0IAAgAkEVanZBAXFyQRxqIQILIAEgAjYCHCABQgA3AhAgAkECdEG0i4CAAGohBAJAAkBBACgCiImAgAAiBkEBIAJ0IgNxDQAgBCABNgIAQQAgBiADcjYCiImAgAAgASAENgIYIAEgATYCCCABIAE2AgwMAQsgAEEAQRkgAkEBdmsgAkEfRht0IQIgBCgCACEGAkADQCAGIgQoAgRBeHEgAEYNASACQR12IQYgAkEBdCECIAQgBkEEcWpBEGoiAygCACIGDQALIAMgATYCACABIAQ2AhggASABNgIMIAEgATYCCAwBCyAEKAIIIgAgATYCDCAEIAE2AgggAUEANgIYIAEgBDYCDCABIAA2AggLQQBBACgCpImAgABBf2oiAUF/IAEbNgKkiYCAAAsLBAAAAAtOAAJAIAANAD8AQRB0DwsCQCAAQf//A3ENACAAQX9MDQACQCAAQRB2QAAiAEF/Rw0AQQBBMDYC9IyAgABBfw8LIABBEHQPCxCMgICAAAALDwAgABCBgICAAEH//wNxCxUAIAAgASACIAMQgoCAgABB//8DcQsVACAAIAEgAiADEIOAgIAAQf//A3ELIQACQCAAEI6AgIAAIgANAEEADwtBACAANgL0jICAAEF/Cw0AIAAoAjgQkYCAgAALcQECfyOAgICAAEEQayIDJICAgIAAQX8hBAJAAkAgAkF/Sg0AQQBBHDYC9IyAgAAMAQsCQCAAIAEgAiADQQxqEJCAgIAAIgJFDQBBACACNgL0jICAAEF/IQQMAQsgAygCDCEECyADQRBqJICAgIAAIAQLuwIBB38jgICAgABBEGsiAySAgICAACADIAI2Agwg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AhA6AAggACABKAIQQQh2OgAJIAAgAUESai8BADoACiAAIAFBE2otAAA6AAsgACABKAIUOgAMIAAgASgCFEEIdjoADSAAIAFBFmovAQA6AA4gACABQRdqLQAAOgAPIAFBAEGYARCagICAABoLKgBBACAANgLAjoCAAEEAIAM2AsiOgIAAQQAgAUEDdCACa603A7iOgIAAC/kCAgJ/B34jgICAgABBsAFrIgIkgICAgABBACEDAkAgAUUNAEEAKQO4joCAAFANACACQv6568XpjpWZEDcDGCACQoHGlLqW8ermbzcDECACIAFBHXY2AgwgAiABQf////8BcTYCCAJAAkAgAUHAAE8NACABIQMMAQsgAUE/cSEDIAJBCGogACABQUBxEKGAgIAAIQALIAJBIGogACADEJmAgIAAGiACQaABaiACQQhqEKKAgIAAQQAhAwJAQQAoAsiOgIAAIgANAEEBIQMMAQtBACgCwI6AgAAiASACKQOgASIEQQApA7iOgIAAIgWCIgZCA4inai0AACAGp0EHcXZBAXFFDQAgAK0iB0J/fCEIIAIpA6gBIgkgBHwhBEIAIQYCQANAAkAgCCAGUg0AIAchBgwCCyAEIAWCIQogBkIBfCEGIAQgCXwhBCABIApCA4inai0AACAKp0EHcXZBAXENAAsLIAYgB1ohAwsgAkGwAWokgICAgAAgAwsIACAAEB4QHAsKACAAIAEQHRAcCwoAIAAgARAfEBwLCgAgACABECAQHAsOACAAIAEgAiADECMQHAsKACAAIAEQJBAcCwt7AQBBgAgLdAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAMAAACABgAAAAAAAAAAAAAAAAAAAgAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAA";
const logElement = document.getElementById("pLogs");
const num1Element = document.getElementById("txtNum1");
const num2Element = document.getElementById("txtNum2");
const textToReverseElement = document.getElementById("txtReverseString");
const textToHashElement = document.getElementById("txtHashString");

const ERRNO_SUCCESS = 0;
const ERRNO_EACCES = 2;

const WASI_IMPORTS = Object.freeze({
  wasi_snapshot_preview1: {
    fd_close: function(fd) {
      log(`WARNING: fd_close(${fd}) unexpectedly invoked`);
      return ERRNO_EACCES;
    },
    fd_seek: function(fd, offset, whence, new_offset_ptr) {
      log(`WARNING: fd_seek(${fd}) unexpectedly invoked`);
      return ERRNO_EACCES;
    },
    fd_write: function(fd, iovs, iovs_len, new_offset_ptr) {
      log(`WARNING: fd_write(${fd}) unexpectedly invoked`);
      return ERRNO_EACCES;
    },
  }
});

function log(text) {
  logElement.appendChild(document.createTextNode(text));
  logElement.appendChild(document.createElement('br'));
  console.log(text);
}

function onClearClick() {
  console.log(`"Clear" button clicked`);
  logElement.innerHTML = "";
}

function MyWebAssemblyInstance(instance) {
  this.echo = function(num) {
    if (typeof(num) !== 'number') {
      throw new Error(`num is not a number: ${num}`);
    }
    instance.exports.echo(num);
  }

  this.add = function(num1, num2) {
    if (typeof(num1) !== 'number') {
      throw new Error(`num1 is not a number: ${num}`);
    }
    if (typeof(num2) !== 'number') {
      throw new Error(`num2 is not a number: ${num}`);
    }
    return instance.exports.add(num1, num2);
  }

  this.reverse = function(s) {
    const buf = new Uint8Array(instance.exports.memory.buffer)
    const { written: numBytes } = new TextEncoder("utf8").encodeInto(s, buf);
    instance.exports.reverse_string(buf, numBytes);
    return new TextDecoder("ascii").decode(buf.subarray(0, numBytes));
  }

  this.hash = function(s) {
    const {hash, memory} = instance.exports;
    let offset = 0;
    const inputBuf = new Uint8Array(memory.buffer, offset, s.length);
    const { written: numBytes } = new TextEncoder("utf8").encodeInto(s, inputBuf);

    const outputBufPtr = hash(inputBuf, numBytes);

    return new Uint8Array(memory.buffer, outputBufPtr, 16);
  }

  this.initBloom = function(bitmap, bitmapLength, padding, hashCount) {
    instance.exports.initBloom(bitmap, bitmapLength, padding, hashCount);
  }

  // DO not call if you haven't called initBloom, or you'll get a null pointer
  // exception!
  this.mightContain = function(s) {
    const {mightContain:mightContainFunction, memory} = instance.exports;
    const buf = new Uint8Array(memory.buffer)
    const { written: numBytes } = new TextEncoder("utf8").encodeInto(s, buf);

    return mightContainFunction(buf, numBytes);
  }
}

async function loadWebAssemblyModule() {
  const wasm = Uint8Array.from(atob(WASM_BASE64), v => v.charCodeAt(0));
  const wasmInstantiateResult = await WebAssembly.instantiate(wasm, {
    base: {
      log: function(num) {
        log(`${num} logged from WebAssembly!`);
      }
    },
    ...WASI_IMPORTS
  });
  const { instance } = wasmInstantiateResult;
  return new MyWebAssemblyInstance(instance);
}

async function onHashTestWasmClick() {
  log("Hash Test Started");
  try {
    const webAssemblyInstance = await loadWebAssemblyModule();
    const numHashes = parseInt(num1Element.value);
    log(`Hashing ${numHashes} strings with WebAssembly MD5 algorithm`);
    let accumulatedMs = 0;

    for (let i=0; i<numHashes; i++) {
      const textToHash = `projects/my-cool-project/databases/(default)/` +
        `documents/collectionA/docA/collectionB/docB/collectionC/doc${i}`;
      const startTime = performance.now();
      webAssemblyInstance.hash(textToHash);
      const endTime = performance.now();
      accumulatedMs += endTime - startTime;
    }

    log(`Hashed ${numHashes} strings with WebAssembly MD5 algorithm ` +
      `in ${accumulatedMs.toFixed(3)} ms`);
  } catch (e) {
    log(`ERROR: ${e}`);
    console.log(e);
  }

  log("Hash Test Completed");
}

async function onRunClick() {
  log("Run Started");
  try {
    const webAssemblyInstance = await loadWebAssemblyModule();

    const num1 = parseInt(num1Element.value);
    const num2 = parseInt(num2Element.value);
    const textToReverse = textToReverseElement.value;
    const textToHash = textToHashElement.value;

    const addResult = webAssemblyInstance.add(num1, num2);
    log(`add(${num1}, ${num2}) returned ${addResult}`);

    webAssemblyInstance.echo(addResult);

    log(`Calling reverse("${textToReverse}")`);
    const reversedText = webAssemblyInstance.reverse(textToReverse);
    log(`Reversed string: ${reversedText}`);

    log(`Calling hash("${textToHash}")`);
    const hashedText = webAssemblyInstance.hash(textToHash);
    log (`Hashed string: ${hashedText}`);
  } catch (e) {
    log(`ERROR: ${e}`);
  }

  log("Run Completed");
}

function saveInputElementValue(element) {
  if (typeof Storage === 'undefined') {
    return;
  }
  window.sessionStorage.setItem(element.id, element.value);
}

function onTextInputChange(event) {
  saveInputElementValue(event.currentTarget);
}

function initializeInputElementValue(element) {
  if (typeof Storage === 'undefined') {
    return;
  }

  const value = window.sessionStorage.getItem(element.id);
  if (! value) {
    return;
  }

  element.value = value;
}

function initializeInputElementValues() {
  initializeInputElementValue(num1Element);
  initializeInputElementValue(num2Element);
  initializeInputElementValue(textToReverseElement);
}

function initializeWasmDemoUI() {
  num1Element.onchange = onTextInputChange;
  num2Element.onchange = onTextInputChange;
  textToReverseElement.onchange = onTextInputChange;

  document.getElementById("btnRun").onclick = onRunClick;
  document.getElementById("btnHashTestWasm").onclick = onHashTestWasmClick;
  document.getElementById("btnClear").onclick = onClearClick;

  initializeInputElementValues();
}

export {loadWebAssemblyModule}
